<?xml version="1.0" encoding="utf-8"?>
<MatchConfiguration xmlns="http://santedb.org/matcher"
                    id="test.dob_and_gender_no_class"
                    uThreshold="0.5"
                    mThreshold="0.9">
  <target resource="Patient">
    <trigger>BeforeInsert</trigger>
    <trigger>BeforeUpdate</trigger>
  </target>
  <blocking op="and" maxResults="1000">
    <imsiExpression trueIfNull="true">dateOfBirth=:(date_diff|$input.dateOfBirth)&lt;2w</imsiExpression>
    <imsiExpression trueIfNull="true">identifier[HIN].value=:(substr|0,6)$input.identifier[HIN].value</imsiExpression>
    <imsiExpression trueIfNull="false">name.component[Family].value=:(phonetic_diff|$input.name.component[Family].value)&lt;2</imsiExpression>
  </blocking>
  <classification>
    <!-- When the input's DOB has the same week as the block's DOB add the weight or add the non weight
      To Calculate Weight:
        (1) Take the probability that a person has the same week DOB and is not a match u=(1/52 = 0.019)
        (2) Estimate the probability that pairs will definately match (perfect data is 1.0) this is an estimation. A 95% chance would be represented as m=0.95
        
       The algorithm will then calculate:
       u(match) = 0.019
       m(match) = 0.95
       u(non-match) = 0.981
       m(non-match) = 0.05
       
       f(match) = m(match)/u(match) = 50  << Frequency ratio of matches based on week of birth
       f(non-match) = m(non-match)/u(non-match) = 0.0509
       
       weight for matches: ln(f(match))/ln(2) = 5.64385
       weight for non-matches: ln(f(non-match))/ln(2) = -4.2961
       
       Please note that you can specify either u and m or matchWeight and nonMatchWeight but not both sets
    -->
    <vector m="0.980" u="0.019" whenNull="match" required="false">
      <rule op="eq">
        <!-- Extract weeks from difference of input and output -->
        <transform name="date.diff">
          <args>
            <string>w</string>
          </args>
        </transform>
      </rule>
    </vector>
  </classification>
</MatchConfiguration>